default_platform(:android)

platform :android do
  desc "Build and sign APK for F-Droid"
  lane :fdroid_release do
    gradle(task: "clean assembleRelease")

    # Optional: if using custom keystore
    # Ensure you’ve set these via environment variables or .env file
    sign_apk(
      keystore_path: ENV["KEYSTORE_PATH"],
      keystore_password: ENV["KEYSTORE_PASSWORD"],
      key_alias: ENV["KEY_ALIAS"],
      key_password: ENV["KEY_PASSWORD"],
      apk_path: Dir["app/build/outputs/apk/release/app-release-unsigned.apk"].first
    )

    # Optional: copy to an output directory
    sh "mkdir -p release"
    sh "cp app/build/outputs/apk/release/app-release-signed.apk release/"

    # Optional: tag git
    # tag_version(version_name: get_version_name, prefix: "v")

    UI.success("✅ APK ready for F-Droid.")
  end
end
